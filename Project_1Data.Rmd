---
title: "Project_1Data"
author: "Jenny Cribbs"
date: "2026-01-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Description 

During the summer of 2023, my UC Davis field crew and my collaborator's UCSB field crew surveyed plots randomly selected plots within sugar pine habitat in Yosemite to determine the incidence of white pine blister rust (WPBR). To test whether fire impacted WPBR or sugar pine recruitment, 23 plots were established in the Rim Fire footprint. 

## Data Citation and Availability

National Park Service Inventory and Monitoring Division. 2025. Blister Rust in Sugar Pine Inventory at Yosemite National Park 2023 - Open Format Dataset. National Park Service. Fort Collins CO
https://doi.org/10.57830/2308454

The data is publically available via the NPS IRMA datastore:
<https://irma.nps.gov/DataStore/Reference/Profile/2308454>

## Data Exploration

```{r}
# load packages
library(tidyverse)

# load data
yose_plots <- read_csv("data/IRMA_YOSE/YOSE_SugarPine_Event.csv")
yose_trees <- read_csv("data/IRMA_YOSE/YOSE_SugarPine_Occurrence.csv")
# look at the variables
colnames(yose_plots)
colnames(yose_trees)
```

Since this dataset needed to meet NPS standards, it contains several columns that aren't relevant to this particular study. As explained in the data description, there were two slightly different sampling protocols for this project. The randomly selected plots within sugar pine habitat were evaluated with the primary goal of assessing each tree for WPBR. If there were no sugar pines at the randomly selected point, the plot was shifted up to 500m (this cutoff was to attempt to keep the plot in the same climate strata) or rejected. The high severity fire plots were not shifted since the goal was to understand post-fire effects and regeneraton. One randomly selected plot 48 had no sugar pines, but we recorded data for the trees and understory vegetation since we spent multiple days getting there. Later we found some sugar pines near the trail in the vicinity of point 48. Unfortunately, the trees were so far from the official plot 48 that this really doesn't meet critiera to be considered a plot. Consequently, I am removing it from this dataset. 

```{r}
# data cleaning
# remove irrelevant event-level columns
yose_plots <- yose_plots %>% select(eventID, samplingProtocol, sampleSizeValue_total, startDateTime, verbatimLatitude, verbatimLongitude, eventRemarks)
# remove irrelevant occurrence-level columns
yose_trees <- yose_trees %>% select(-basisOfRecord, -scientificName, -individualCount, -organismQuantity, -organismQuantityType, -publicDisplay, -dataAccess, -lifeStage, -sex, -behavior, -covariateSample, -preparations, -identifiedBy, -identificationReferences, -identificationRemarks, -identificationQualifier, -identificationVerificationStatus, -materialSampleID, -recordNumber, -organismRemarks, -identificationID)

# join to add plot info to the tree table 
yose <- left_join(yose_trees, yose_plots, by = "eventID")

# remove "plot" 48 since it doesn't meet plot criteria
# check that these 34 trees are from plot 48
yose48 <- yose[yose$eventID == 48, ]
# subset to keep only trees in normal plots
yose <- yose[yose_trees$eventID != 48, ]

```


## Data Exploration


```{r}
# overview of the data
summary(yose)
# distributions of the continuous variables
hist(yose$diameter, breaks = 50)
hist(yose$height, breaks = 50)
hist(yose$percentLive, breaks = 50)
```

None of these distributions are normal. Percent live is almost bimodal with quite a few zeros for dead trees and many very healthy trees in the high 90s to 100 percent live. There are trees in between, but it took adding a lot of breaks to even see that. I suspect the trees with WPBR will make up a large part of the relatively rare cases in the middle of the percent live spectrum. I'm not sure exactly how to test/show this, but will return to this later. 

```{r}
cor(yose$diameter, yose$height, use = "complete.obs")
cor(yose$diameter, yose$percentLive, use = "complete.obs")
cor(yose$height, yose$percentLive, use = "complete.obs")

```

As expected there is a strong correlation between tree girth and height. There is a weak negative correlation between tree girth and percent live, and not much of a correlation between height and percent live. Very large diameter trees tend to be older, and may simply have had more time to get attacked by pests and pathogens or get damaged mechanically. 


```{r}
# simple linear regression
m1 <- lm(yose$height ~ yose$diameter)
# plot height versus diameter
plot(yose$diameter, yose$height)
abline(m1, col = "red")
```

The overall fit looks pretty good, though it might be improved a bit by accounting for the fact that trees grow taller a little faster than they grow wider. The regression line falls a bit below the bulk of the data points from zero to a little less than 100cm in diameter. 

Also, we have an outlier with a height of almost 150 meters. This is almost certainly a data entry error that made it past our data cleaning because the tallest known sugar pines are just over 80m. I actually vaguely remember going through this exercise during initial data cleaning, so either we had a similar error before or somehow the most updated datasheet did not make it on the IRMA site. I'll have to let our NPS partners know!

```{r}
# look at coefficients
m1
# model diagnostic plots 
plot(m1)

```
Next steps: check original datasheets, confirm data entry error, fix the outlier point or remove if not possible to correct. Re-run model. Compare the coefficents with allometric equations for sugar pines or pines generally. Consider if transformations or another type of model could do better with the small trees. Both diameter and height have skewed distributions... Consider what to do with the almost bimodal percent live variable and beetle and blister rust observations. Presence/absence is the easiest for both, but the raw data is actually a combination of various signs (beetles: pitch tubes and/or exit holes for one of two species WPBR: active/inactive branch/bole canker counts).
